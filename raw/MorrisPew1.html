<!DOCTYPE html> 
<meta charset="utf-8">
<link rel='stylesheet' href=//cdn.oesmith.co.uk/morris-0.4.2.min.css>
<script type='text/javascript' src=//ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js></script>
<script type='text/javascript' src=//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js></script>
<script type='text/javascript' src=//cdn.oesmith.co.uk/morris-0.4.2.min.js></script> 

<body>
<p>This page explores the creation of simple interactive charts created from unweighted data from The Pew Research Center's American Life Project, "The Social Side of the Internet". Permission to use the survey data was granted by the Pew Research Center's Internet Project December 2013. </p><p></p>
<P> The charts were constructed using rCharts, with plyr, reshape2 packages installed. Simple data preparation steps appear below. </p>
<code>dat2 <- subset(dat,select = c(psraid,icat,rcat,liv,ideocat))</code>
<code>dat1tbl <- table(icat)  # Aggregate counts </code>
<code>dat1tblprop <-prop.table(dat1tbl) # Aggregate proportions</code>
<code>tbl1_icat <- as.data.frame(dat1tblprop) #convert to data frame</code>
<code>tbl1_icat$pct=100*round(tbl1_icat$Freq, digits = 3) #Round to one decimal place</code>
<code>tbl1pie <-rename(tbl1_icat,c(icat="label",Freq="prop",pct="value")) # uses plyr </code>
<p>The chart creation code: </p>
<code>pie_icat <- mPlot(x = "label", y = "value", data = tbl1pie, type = "Donut")</code>
<code>pie_icat</code>
<code>pie_icat$print("PieInc", cdn = TRUE, include_assets = TRUE)</code>
<p>
<strong>Last year, that is in 2009, what was your total family income from all sources, before taxes?  Just stop me when I get to the right category... </strong> </p>
<div id = 'PieInc' class = 'rChart morris'></div>
<script type='text/javascript'>
    var chartParams = {
 "element": "PieInc",
"width":            300,
"height":           200,
"xkey": "label",
"ykeys": [
 "value" 
],
"data": [
 {
 "label": "$100K - under $150K",
"prop": 0.08293530178029,
"value":            8.3 
},
{
 "label": "$10K - under $30K",
"prop": 0.1884498480243,
"value":           18.8 
},
{
 "label": "$150K +",
"prop": 0.06296135475467,
"value":            6.3 
},
{
 "label": "$30K - under $50K",
"prop": 0.1697785497178,
"value":             17 
},
{
 "label": "$50K - under $75K",
"prop": 0.1289622231871,
"value":           12.9 
},
{
 "label": "$75K - under $100K",
"prop": 0.1037776812853,
"value":           10.4 
},
{
 "label": "Less than $10K",
"prop": 0.06947459834998,
"value":            6.9 
},
{
 "label": "Unknown/Refused",
"prop": 0.1936604429006,
"value":           19.4 
} 
],
"formatter":  function (value,label) { return(value + "%"); } ,
"id": "PieInc",
"labels": "value" 
},
      chartType = "Donut"
    new Morris[chartType](chartParams)
</script>
<p> <strong>Which of the following BEST describes the place where you now live?</strong> </p>
<div id = 'PieLiv' class = 'rChart morris'></div>
<script type='text/javascript'>
    var chartParams = {
 "element": "PieLiv",
"width":            300,
"height":           200,
"xkey": "label",
"ykeys": [
 "value" 
],
"data": [
 {
 "label": "Large city",
"prop": 0.1810681719496,
"value":           18.1 
},
{
 "label": "Rural     ",
"prop": 0.2184107685627,
"value":           21.8 
},
{
 "label": "Small city or town",
"prop": 0.3495440729483,
"value":             35 
},
{
 "label": "Suburb     ",
"prop": 0.2323056882327,
"value":           23.2 
},
{
 "label": "Unknown/Refused",
"prop": 0.01867129830656,
"value":            1.9 
} 
],
"formatter":  function (value,label) { return(value + "%"); } ,
"id": "PieLiv",
"labels": "value" 
},
      chartType = "Donut"
    new Morris[chartType](chartParams)
</script>
<p><strong>In general, would you describe your political views as... </strong></p>
<div id = 'PieIdeo' class = 'rChart morris'></div>
<script type='text/javascript'>
    var chartParams = {
 "element": "PieIdeo",
"width":            300,
"height":           200,
"xkey": "label",
"ykeys": [
 "value" 
],
"data": [
 {
 "label": "Conservative",
"prop": 0.2913590968302,
"value":           18.1 
},
{
 "label": "Liberal/Very Liberal",
"prop": 0.2140686061659,
"value":           21.8 
},
{
 "label": "Moderate",
"prop": 0.3061224489796,
"value":             35 
},
{
 "label": "Unknown/Refused",
"prop": 0.1102909248806,
"value":           23.2 
},
{
 "label": "Very conservative",
"prop": 0.07815892314373,
"value":            1.9 
} 
],
"formatter":  function (value,label) { return(value + "%"); } ,
"id": "PieIdeo",
"labels": "value" 
},
      chartType = "Donut"
    new Morris[chartType](chartParams)
</script>

<div id=foot></div>
<p> A note about the layout. The chart generated by the <code>mplot</code> call above comes without the percent sign attached to the value in the center of the donut. The layout looks generally like the following. The location and structure of the formatter function is indicated. </p>
<img src="http://www.d8aism.com/wp-content/uploads/2016/03/MorrisFormatString-300x209.png" alt="MorrisFormatString" width="300" height="209" class="alignnone size-medium wp-image-374" />
</body>
</html>
